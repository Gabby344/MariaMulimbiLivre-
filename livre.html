<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Livre d'Or des Souhaits ‚Äì Joyeux Anniversaire Ruth Mulimbi</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Merriweather:ital,wght@0,300;0,700;1,300;1,400&family=Sacramento&display=swap" rel="stylesheet">
    
    <script>
        // Configuration Tailwind pour harmoniser les couleurs avec index.html
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-wine': '#8a0c4f',      /* Bordeaux Profond */
                        'secondary-pink': '#e990b0',    /* Rose doux */
                        'bg-paper': '#fffcf8',          /* Fond clair */
                        'elegant-gray': '#4a4a4a',      /* Gris fonc√© pour le texte principal */
                    },
                    fontFamily: {
                        'serif': ['Merriweather', 'serif'],
                        'display': ['Playfair Display', 'serif'],
                        'sacramento': ['Sacramento', 'cursive'],
                    }
                }
            }
        }
    </script>

    <script type="module">
        // Importation des modules Firebase (SANS AUTHENTIFICATION)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- CONFIGURATION FIREBASE (REPRISE DE INDEX.HTML) ---
        const userProvidedConfig = {
            apiKey: "AIzaSyCQdZppl-UsPCXF8iFmXQpcGAFjHEMt838",
            authDomain: "gestion-saint-charles-lwanga.firebaseapp.com",
            projectId: "gestion-saint-charles-lwanga",
            storageBucket: "gestion-saint-charles-lwanga.firebasestorage.app",
            messagingSenderId: "508302363143",
            appId: "1:508302363143:web:35c181528dd84def1a78a2"
        };
        // ------------------------------

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'lwangagestion';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : userProvidedConfig;
        
        let app, db; // 'auth' a √©t√© supprim√©
        const livre = document.getElementById('livre');

        // üíñ LOGIQUE DU CARROUSEL (Corrig√©e pour √™tre en boucle fluide)
        const totalBookImages = 3; 
        const bookCarousel = document.getElementById('bookCarousel');
        let bookCurrentIndex = 0;
        const bookSlideWidth = 100 / (totalBookImages + 1); 
        const bookTransitionDuration = 1200; 

        function startCarousel() {
            if (!bookCarousel) return;

            setInterval(() => {
                bookCurrentIndex++;
                const offset = -bookCurrentIndex * bookSlideWidth; 
                
                bookCarousel.style.transition = `transform ${bookTransitionDuration / 1000}s cubic-bezier(0.42, 0, 0.58, 1)`;
                bookCarousel.style.transform = `translateX(${offset}%)`;

                if (bookCurrentIndex >= totalBookImages) {
                    setTimeout(() => {
                        bookCarousel.style.transition = 'none';
                        bookCurrentIndex = 0;
                        bookCarousel.style.transform = 'translateX(0)';
                    }, bookTransitionDuration); 
                }
            }, 6000); // D√©filement toutes les 6 secondes
        }

        // 1. Initialisation SANS AUTHENTIFICATION
        async function initializeAppAndLoad() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                
                console.log("Firebase Init OK (Authentification ignor√©e).");
                loadTestimonials();
                startCarousel(); 
            } catch (error) {
                console.error("Erreur Firebase au d√©marrage :", error);
                livre.innerHTML = "<p class='text-center text-red-600 mt-10 p-4 bg-white rounded-xl shadow-md'>‚ö†Ô∏è Erreur : Probl√®me de connexion. Veuillez v√©rifier votre cl√© API et Project ID.</p>";
            }
        }

        // 2. Fonction de partage WhatsApp (Rendue globale)
        window.shareWhatsApp = (message, sender) => {
            const cleanMessage = message.trim();
            // Lien plus court et message concis
            const formattedMessage = `Message pour Ruth de ${sender}: "${cleanMessage.substring(0, 150)}..." (Voir le livre : ${window.location.href})`;
            const encoded = encodeURIComponent(formattedMessage);
            window.open(`https://api.whatsapp.com/send?text=${encoded}`, '_blank');
        };

        // 3. Chargement et affichage des t√©moignages (Real-time avec compteur et indicateur "Nouveau")
        function loadTestimonials() {
            const collectionPath = `artifacts/${appId}/public/data/testimonials`;
            const testimonialsRef = collection(db, collectionPath);
            const q = query(testimonialsRef, orderBy("timestamp", "desc"));
            const messageCountElement = document.getElementById('messageCount');

            onSnapshot(q, (snapshot) => {
                const count = snapshot.size;
                // Mise √† jour du compteur professionnel
                messageCountElement.innerHTML = `<span class="text-primary-wine font-extrabold text-5xl mr-2">${count}</span> messages enregistr√©s üíñ`;

                if (snapshot.empty) {
                    livre.innerHTML = "<p class='text-center text-gray-500 mt-10 p-4 bg-white rounded-xl shadow-md italic'>Aucun t√©moignage n‚Äôa encore √©t√© ajout√©. Soyez le premier √† laisser votre mot !</p>";
                    return;
                }

                livre.innerHTML = ''; 
                snapshot.forEach((docSnapshot, index) => {
                    const data = docSnapshot.data();
                    const name = data.name || "Un admirateur Anonyme";
                    const message = data.message || "Un beau souhait !";
                    
                    const timestamp = data.timestamp ? data.timestamp.toDate() : new Date();
                    const date = timestamp.toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' });
                    
                    const safeMessage = message.replace(/'/g, "\\'").replace(/"/g, '\\"');
                    const safeName = name.replace(/'/g, "\\'").replace(/"/g, '\\"');
                    
                    const isRecent = index < 5; // Marque les 5 premiers messages comme "Nouveau"

                    const div = document.createElement('div');
                    div.className = `testimonial bg-white p-7 md:p-10 mb-8 rounded-2xl shadow-xl relative border-l-8 border-secondary-pink/70 hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-0.5 ${isRecent ? 'recent' : ''}`;
                    
                    const newBadge = isRecent 
                        ? `<span class="bg-primary-wine text-white text-xs font-bold px-3 py-1 rounded-full ml-3 tracking-widest uppercase shadow-md">Nouveau !</span>` 
                        : '';

                    div.innerHTML = `
                        <div class="testimonial-header flex justify-between items-start mb-4 border-b border-primary-wine/30 pb-3">
                            <strong class="text-2xl font-display font-bold text-primary-wine">${name} ${newBadge}</strong>
                            <small class="text-gray-500 italic text-sm mt-1">√âcrit le ${date}</small>
                        </div>
                        
                        <p class="text-elegant-gray whitespace-pre-line text-lg mb-4 font-serif leading-relaxed italic border-l-4 border-secondary-pink/20 pl-4">‚Äú${message}‚Äù</p>
                        
                        <button 
                            onclick="shareWhatsApp('${safeMessage}','${safeName}')" 
                            class="whatsapp-share-button"
                            title="Partager ce message sur WhatsApp"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" class="w-5 h-5">
                                <path d="M12.031 0C5.405 0 0 5.405 0 12.031c0 2.067.531 4.01 1.54 5.71l-.974 3.766 3.868-.973c1.676.953 3.593 1.458 5.497 1.458 6.626 0 12.031-5.405 12.031-12.031C24.062 5.405 18.657 0 12.031 0z"/>
                            </svg>
                        </button>
                    `;
                    livre.appendChild(div);
                });
            }, (error) => {
                console.error("Erreur onSnapshot Firestore :", error);
                messageCountElement.innerHTML = `<span class="text-red-600 font-extrabold text-5xl mr-2">!</span> Erreur de chargement.`;
                livre.innerHTML = "<p class='text-center text-red-600 mt-10 p-4 bg-white rounded-xl shadow-md'>‚ö†Ô∏è Erreur : Probl√®me de connexion en temps r√©el aux messages. V√©rifiez les r√®gles de lecture.</p>";
            });
        }

        document.addEventListener('DOMContentLoaded', initializeAppAndLoad);
    </script>

    <style>
        /* Styles de base pour le corps et la mise en page (Harmonisation) */
        body {
            font-family: theme('fontFamily.serif');
            background-color: theme('colors.bg-paper');
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            color: theme('colors.elegant-gray');
        }
        
        main {
            flex-grow: 1;
            max-width: 1000px;
            margin: 40px auto;
            width: 95%;
            padding: 40px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.2); 
            border-radius: 20px;
            background-color: white; 
            border-top: 8px solid theme('colors.primary-wine');
        }

        /* TITRES ET COMPTEUR */
        h1 {
            font-family: theme('fontFamily.display');
            letter-spacing: 3px;
        }

        .intro {
            font-family: theme('fontFamily.sacramento'); 
            color: theme('colors.primary-wine');
            border-bottom: 2px solid theme('colors.secondary-pink'); 
            font-size: 2.2rem;
            line-height: 1.4;
            padding-bottom: 10px;
        }

        /* NOUVEAU: Style pour les messages r√©cents (effet "Nouveau") */
        .testimonial.recent {
            border-left: 8px solid theme('colors.primary-wine') !important;
            box-shadow: 0 10px 40px rgba(138, 12, 79, 0.25);
        }

        /* --- STYLES CARROUSEL --- */
        .hero-carousel-container {
            position: relative;
            height: 450px;
            margin-bottom: 50px;
            overflow: hidden; 
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }
        .carousel-track {
            display: flex;
            width: 400%; 
            height: 100%;
        }
        .carousel-item {
            width: 25%; 
            flex-shrink: 0;
        }
        .carousel-item img {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            filter: brightness(90%);
        }

        /* --- BOUTONS D'ACTION STYL√âS (Imprimer et Retour) --- */
        .action-button {
            /* Style unifi√© et pro */
            @apply inline-flex items-center 
                   px-10 py-4 
                   rounded-full text-white 
                   text-lg font-bold tracking-wider 
                   transition-all duration-300 transform 
                   hover:scale-[1.03] focus:outline-none 
                   shadow-xl; 
        }

        /* Bouton Imprimer: Couleur Contraste (Vert Pro / Bleu Marine) - Rendu professionnel */
        .print-button {
            background: linear-gradient(135deg, #10B981, #059669); /* Vert Emeraude */
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.6); 
            text-transform: uppercase;
        }
        .print-button:hover {
            box-shadow: 0 12px 30px rgba(16, 185, 129, 0.8);
        }

        /* Bouton Retour: Couleur Primaire (Harmonie avec le site) */
        .back-button {
            background: linear-gradient(135deg, theme('colors.primary-wine'), theme('colors.secondary-pink'));
            box-shadow: 0 8px 20px rgba(138, 12, 79, 0.6); 
            text-transform: uppercase;
        }
        .back-button:hover {
            box-shadow: 0 10px 25px rgba(138, 12, 79, 0.8);
        }

        /* Bouton Partage WhatsApp sur chaque message */
        .whatsapp-share-button {
            @apply absolute bottom-4 right-4 p-3 rounded-full 
                   bg-green-500 hover:bg-green-600 
                   transition duration-200 shadow-lg 
                   transform hover:scale-110 focus:outline-none;
            width: 48px;
            height: 48px;
        }

        /* MEDIA PRINT (Optimisation pour l'impression papier) */
        @media print {
            body { background: white; padding: 0; margin: 0; }
            main { box-shadow: none; border-radius: 0; margin: 0; padding: 0; width: 100%; border: none; }
            .action-button-container, footer, .hero-carousel-container, .whatsapp-share-button, .intro, #messageCount { 
                display: none !important; 
            }
            .testimonial {
                box-shadow: none !important;
                border: 1px dashed #ccc;
                page-break-inside: avoid;
                margin-bottom: 20px;
                padding: 20px;
                border-left: 5px solid theme('colors.primary-wine') !important; 
            }
            .testimonial-header strong { color: black !important; }
            .testimonial p { font-style: normal; font-size: 1.1em; color: black; }
        }
    </style>
</head>

<body>
    <main>
        <div class="hero-carousel-container" id="heroCarouselContainer">
            <div class="carousel-track" id="bookCarousel">
                <div class="carousel-item"><img src="book_photo1.JPG" alt="Ruth Mulimbi - Photo 1" loading="lazy"></div>
                <div class="carousel-item"><img src="book_photo2.JPG" alt="Ruth Mulimbi - Photo 2" loading="lazy"></div>
                <div class="carousel-item"><img src="book_photo3.JPG" alt="Ruth Mulimbi - Photo 3" loading="lazy"></div>
                <div class="carousel-item"><img src="book_photo1.JPG" alt="Ruth Mulimbi - Photo 1" loading="lazy"></div>
            </div>
        </div>

        <h1 class="text-4xl lg:text-5xl text-center mt-0 mb-4 text-primary-wine">Livre d'Or des Souhaits</h1>
        
        <p id="messageCount" class="text-center font-serif text-xl mb-10 text-gray-600">
            Chargement du compte...
        </p>

        <div class="intro text-center pb-4 mb-10 mx-auto max-w-2xl">
            ¬´ Un bouquin d‚Äôamour et de b√©n√©dictions pour Ruth Mulimbi, c√©l√©brons la bonne personne qu'elle est. Joyeux Anniversaire Maria ! ¬ª
        </div>

        <div id="livre" class="space-y-6">
            <div class="text-center text-gray-400 p-8 font-serif">Connexion et chargement des messages...</div>
        </div>

        <div class="action-button-container flex flex-wrap justify-center gap-6 mt-16 mb-12">
            
            <button onclick="window.print()" class="action-button print-button">
                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m0 0l2.585 2.585a2 2 0 002.828 0L17 17m0 0v-4a2 2 0 00-2-2h-4a2 2 0 00-2 2v4"></path></svg>
                Imprimer le livre
            </button>

            <a href="index.html" class="action-button back-button">
                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 15l-3-3m0 0l3-3m-3 3h8m-9 6h10a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                Retour √† l'accueil
            </a>
        </div>
    </main>

    <footer>
        <p class="text-gray-500 font-serif text-sm">‚Äî Cr√©√© avec amour par Gabby Umba 2025 ‚Äî</p>
    </footer>

</body>
</html>
