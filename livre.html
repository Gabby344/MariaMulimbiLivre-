<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Livre d'Or - Messages pour Ruth</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Merriweather:wght@300;400;700&family=Sacramento&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore-compat.js"></script>

    <script>
        // Configuration Tailwind harmonis√©e
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-wine': '#8a0c4f',      /* Bordeaux Profond */
                        'secondary-pink': '#e990b0',    /* Rose doux */
                        'bg-paper': '#fffcf8',          /* Fond clair */
                    },
                    fontFamily: {
                        'serif': ['Merriweather', 'serif'],
                        'display': ['Playfair Display', 'serif'],
                        'sacramento': ['Sacramento', 'cursive'],
                    }
                }
            }
        }
    </script>

    <style>
        /* Variables CSS */
        :root {
            --rose-fonce: #8a0c4f;
            --rose-doux: #e990b0;
            --fond: #fffcf8;
            --fond-secondaire: #fef0f4;
            --texte: #3c3c3c;
        }

        body {
            font-family: theme('fontFamily.serif');
            background: linear-gradient(135deg, var(--fond), var(--fond-secondaire));
            color: var(--texte);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            text-align: center;
        }

        main {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
            flex-grow: 1;
        }

        /* --- STYLES CORRIG√âS --- */
        .main-title {
            color: var(--rose-fonce);
            font-family: theme('fontFamily.display');
            letter-spacing: 3px;
            text-shadow: 2px 3px 5px rgba(0,0,0,0.1); 
            font-weight: 700;
        }
        
        .intro-quote {
            max-width: 650px;
            margin: 30px auto 40px auto;
            font-family: theme('fontFamily.serif');
            font-size: 1.5rem;
            line-height: 1.8;
            color: #555;
            border-left: 5px solid var(--rose-doux);
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.5); 
            border-radius: 5px;
            font-style: italic;
        }

        /* --- NOUVEAU: Animation d'entr√©e --- */
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-message {
            animation: fade-in-up 0.5s ease-out forwards;
            opacity: 0; /* Assure qu'ils sont invisibles avant l'animation */
        }
        
        /* Cartes de messages (T√©moignages) */
        .testimonial-card {
            background: #ffffff;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            border: 1px solid var(--fond-secondaire);
            text-align: left;
            position: relative;
        }
        
        .testimonial-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 8px;
            height: 100%;
            background: linear-gradient(to bottom, var(--rose-fonce), var(--rose-doux));
            border-top-left-radius: 15px;
            border-bottom-left-radius: 15px;
        }
        
        .testimonial-name {
            font-family: theme('fontFamily.display');
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--rose-fonce);
            margin-bottom: 5px;
            padding-left: 15px; 
            border-bottom: 1px dashed #eee;
            padding-bottom: 10px;
        }
        
        .testimonial-message {
            font-size: 1.1em;
            line-height: 1.6;
            margin-top: 15px;
            padding-left: 15px;
            color: #444;
            font-style: italic;
        }
        
        /* --- NOUVEAU: Signature Manuscrite --- */
        .testimonial-signature {
            display: block;
            text-align: right;
            margin-top: 20px;
            font-family: theme('fontFamily.sacramento'); 
            font-size: 2.2rem; 
            color: var(--rose-fonce);
            line-height: 1;
            padding-top: 10px;
            border-top: 1px dashed var(--rose-doux);
        }

        .testimonial-date {
            font-size: 0.85rem;
            color: #999;
            font-style: normal; /* Annule l'italic parent */
            display: block;
            text-align: right;
            margin-top: 5px;
            margin-bottom: 0;
        }
        
        /* --- STYLES DES BOUTONS (Uniformisation) --- */
        .action-button {
            @apply inline-flex items-center justify-center 
                   px-10 py-4 
                   text-xl font-extrabold text-white
                   rounded-full 
                   transition-all duration-300 ease-out; 

            box-shadow: 0 8px 20px rgba(138, 12, 79, 0.5); 
            letter-spacing: 1px;
            text-transform: uppercase;
            width: 300px;
            margin: 15px auto;
        }

        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(138, 12, 79, 0.7);
        }

        #printButton {
            background: linear-gradient(135deg, #4CAF50, #008000); 
        }
        #printButton:hover {
            background: linear-gradient(135deg, #008000, #4CAF50);
        }

        #returnButton {
            background: linear-gradient(135deg, var(--rose-fonce), #FF69B4); 
        }
        #returnButton:hover {
            background: linear-gradient(135deg, #FF69B4, var(--rose-fonce));
        }


        /* --- STYLES D'IMPRESSION (@media print) --- */
        @media print {
            body {
                background: none;
                color: #000;
                font-size: 12pt;
            }
            main {
                max-width: none;
                margin: 0;
                padding: 0;
            }
            .no-print {
                display: none !important;
            }
            header, footer {
                display: none;
            }
            h1, .intro-quote, #messageCount {
                text-align: center;
                margin-top: 1em;
            }
            .testimonial-card {
                box-shadow: none;
                border: 1px solid #ccc;
                margin-bottom: 20px;
                break-inside: avoid;
            }
            .testimonial-card::before {
                display: none;
            }
            .testimonial-name, .testimonial-message, .testimonial-date {
                padding-left: 0;
            }
            /* Rendre la signature plus lisible √† l'impression */
            .testimonial-signature {
                font-family: Arial, sans-serif !important; 
                font-size: 1.2em;
                color: #000;
                border-top: 1px solid #ccc;
            }
        }

    </style>
</head>

<body>
    <header class="no-print">
        <div class="h-5 bg-primary-wine"></div>
    </header>

    <main>
        
        <h1 class="main-title text-5xl lg:text-6xl text-center mt-12 mb-2 font-extrabold tracking-widest">
            Livre d'Or des Souhaits
        </h1>
        
        <p id="messageCount" class="text-xl font-display text-gray-700 mb-8 font-bold">
            <span class="text-4xl text-primary-wine font-extrabold" id="countValue">...</span> messages enregistr√©s üíñ
        </p>

        <blockquote class="intro-quote">
            ¬´ Un bouquin d'amour et de b√©n√©dictions pour Ruth Mulimbi, c√©l√©brons la bonne personne qu'elle est. Joyeux Anniversaire ! ¬ª
        </blockquote>

        <section id="testimonialsContainer" class="mt-8"></section>

        <div class="no-print flex flex-col items-center justify-center pt-8 pb-16">
            
            <button id="printButton" class="action-button" onclick="window.print()">
                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m0 0v-2a2 2 0 012-2h4a2 2 0 012 2v2m-5 0h2m-7.5 0h3"></path></svg>
                Imprimer le livre
            </button>
            
            <a href="index.html" id="returnButton" class="action-button">
                <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12"></path></svg>
                Retour √† l'accueil
            </a>
        </div>

    </main>

    <footer>
        <span class="text-gray-500 mb-6 block text-sm">--- Cr√©√© avec amour par Gabby Umba 2025 ---</span>
    </footer>


    <script>
        // Initialisation Firebase (compatible v9, SANS AUTH)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'lwangagestion';

        const firebaseConfig = typeof __firebase_config !== 'undefined' 
            ? JSON.parse(__firebase_config) 
            : {
                apiKey: "AIzaSyCQdZppl-UsPCXF8iFmXQpcGAFjHEMt838",
                authDomain: "gestion-saint-charles-lwanga.firebaseapp.com",
                projectId: "gestion-saint-charles-lwanga",
                storageBucket: "gestion-saint-charles-lwanga.firebasestorage.app",
                messagingSenderId: "508302363143",
                appId: "1:508302363143:web:35c181528dd84def1a78a2"
            };

        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // R√©f√©rences aux √©l√©ments du DOM
        const container = document.getElementById('testimonialsContainer');
        const countValue = document.getElementById('countValue');
        const collectionPath = `artifacts/${appId}/public/data/testimonials`;

        // Fonction de formatage de la date (J/M/A)
        const formatDate = (timestamp) => {
            if (!timestamp) return 'Date inconnue';
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
            return date.toLocaleDateString('fr-FR', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });
        };

        // Fonction pour charger et afficher les messages
        const loadTestimonials = async () => {
            container.innerHTML = '';
            
            try {
                const snapshot = await db.collection(collectionPath)
                                         .orderBy('timestamp', 'desc') 
                                         .get();

                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-2xl text-gray-500 mt-16 font-display">Aucun message n\'a encore √©t√© enregistr√©. Soyez le premier !</p>';
                    countValue.textContent = '0';
                    return;
                }
                
                let count = 0;
                let delay = 0;
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const formattedDate = formatDate(data.timestamp);
                    count++;
                    
                    // Utilisation de la nouvelle structure HTML et de la classe d'animation
                    const card = document.createElement('div');
                    card.className = 'testimonial-card animate-message';
                    card.style.animationDelay = `${delay}ms`; 
                    
                    card.innerHTML = `
                        <p class="testimonial-message">¬´ ${data.message} ¬ª</p>
                        
                        <div class="mt-8 flex justify-end items-end">
                            <div>
                                <span class="testimonial-date">Le ${formattedDate}</span>
                                <span class="testimonial-signature">${data.name || 'Anonyme'}</span>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                    
                    delay += 100; // D√©lai incr√©mental pour l'effet de cascade
                });

                countValue.textContent = count;

            } catch (error) {
                console.error("Erreur de chargement des messages:", error);
                container.innerHTML = `
                    <div class="mt-16 p-6 bg-red-100 border-l-4 border-red-500 text-red-700 rounded-lg">
                        <p class="text-xl font-bold font-display">‚ö†Ô∏è Erreur : Impossible de se connecter √† la base de donn√©es.</p>
                        <p class="mt-2">Veuillez v√©rifier les r√®gles de s√©curit√© Firestore pour vous assurer que la lecture est autoris√©e (allow read: if true).</p>
                    </div>
                `;
                countValue.textContent = 'Erreur';
            }
        };

        document.addEventListener('DOMContentLoaded', loadTestimonials);
    </script>
</body>
</html>
